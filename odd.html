<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>7th Sem SGPA Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="predictor4.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1e1e1e;
      color: #f0f0f0;
    }
    h1, h2, h3 { color: #f0f0f0; }
    .subject-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    label { width: 320px; font-weight: bold; }
    input[type="number"] { width: 100px; padding: 5px; }
    .output-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .output-table th, .output-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .possible { background-color: #24532f; }
    .not-possible { background-color: #772020; }
    .realistic { background-color: #786214; }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .info { font-size: 14px; color: #aaa; }
    button {
      padding: 8px 15px;
      margin: 10px 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="top-bar">
  <h1>7th Semester SGPA Predictor</h1>
  <button onclick="logout()">Logout</button>
</div>

<p class="info" id="userInfo"></p>

<div id="form"></div>

<button onclick="predictGrades()">Predict SGPA</button>
<button onclick="clearInputs()">Clear Data</button>

<div id="result"></div>

<script>
/* ========= AUTH ========= */
const name = localStorage.getItem("name");
const semester = localStorage.getItem("semester");

if (!name || semester !== "7") {
  window.location.href = "under_construction.html";
}

document.getElementById("userInfo").innerText =
  `ðŸ‘¤ ${name} | Semester: ${semester}`;

/* ========= SUBJECTS ========= */
const subjects = [
  { name: "Neural Networks and Deep Learning", credits: 4, isHalf: false },
  { name: "Medical Imaging Techniques", credits: 3, isHalf: false },
  { name: "Wearable Devices", credits: 3, isHalf: false },
  { name: "Open Elective", credits: 3, isHalf: false },
  { name: "Skill Enhancement Lab", credits: 3, isHalf: true },
  { name: "AI in Healthcare Lab", credits: 1, isHalf: true }
];

/* ========= GRADING ========= */
const grades = [10, 9, 8, 7, 6, 5, 0];
const gradeLabels = {10:"O",9:"A+",8:"A",7:"B+",6:"B",5:"C",0:"F"};
const selectedGrades = {};

/* ========= BUILD FORM ========= */
const form = document.getElementById("form");
subjects.forEach((sub, i) => {
  const div = document.createElement("div");
  div.className = "subject-group";
  div.innerHTML = `
    <label>${sub.name} (Internal Marks):</label>
    <input type="number" id="sub${i}" min="0" max="50">
  `;
  form.appendChild(div);
});

/* ========= LOGIC ========= */
function calculateRequiredMarks(internal, grade, isHalf) {
  const lower = {10:90,9:80,8:70,7:60,6:50,5:40}[grade];
  if (!lower) return -1;
  const req = isHalf ? (lower - internal) : 2 * (lower - internal);
  const max = isHalf ? 50 : 100;
  return (req < 0 || req > max) ? -1 : req;
}

function predictGrades() {
  document.getElementById("result").innerHTML = "";
  Object.keys(selectedGrades).forEach(k => delete selectedGrades[k]);

  let html = "";

  subjects.forEach((sub, i) => {
    const internal = parseFloat(document.getElementById(`sub${i}`).value);
    if (isNaN(internal)) return;

    html += `<h3>${sub.name}</h3><table class="output-table"><tr>`;
    grades.forEach(g => html += `<th>${gradeLabels[g]}</th>`);
    html += `</tr><tr>`;

    grades.forEach(g => {
      const r = calculateRequiredMarks(internal, g, sub.isHalf);
      const cls = r === -1 ? "not-possible" :
        (r <= (sub.isHalf ? 45 : 86) ? "realistic" : "possible");
      html += `<td class="${cls}">${r === -1 ? "-" : r.toFixed(1)}</td>`;
    });

    html += `</tr></table>`;

    let def = 0;
    for (let g of grades) {
      const r = calculateRequiredMarks(internal, g, sub.isHalf);
      if (r !== -1 && r <= (sub.isHalf ? 45 : 86)) { def = g; break; }
    }

    selectedGrades[sub.name] = def;

    html += `<p><strong>Select Expected Grade:</strong><br>`;
    grades.forEach(g => {
      html += `
        <label>
          <input type="radio" name="g${i}" ${g===def?"checked":""}
          onchange="updateSelectedGrade('${sub.name}',${g})">
          ${gradeLabels[g]}
        </label>
      `;
    });
    html += `</p>`;
  });

  document.getElementById("result").innerHTML = html;
  updateSGPA();
}

function updateSelectedGrade(sub, g) {
  selectedGrades[sub] = g;
  updateSGPA();
}

function updateSGPA() {
  let tc = 0, tp = 0;
  subjects.forEach(s => {
    if (selectedGrades[s.name] !== undefined) {
      tc += s.credits;
      tp += selectedGrades[s.name] * s.credits;
    }
  });

  const sgpa = (tp / tc).toFixed(2);
  document.getElementById("result")
    .insertAdjacentHTML("beforeend", `<h2>ðŸŽ¯ SGPA: ${sgpa}</h2>`);

  saveResult(sgpa);
}

/* ========= BACKEND ========= */
function saveResult(sgpa) {
  fetch("https://sgpa-backend-m676.onrender.com/save-history", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name,
      semester,
      result: sgpa,
      grades: selectedGrades
    })
  });
}

/* ========= UTIL ========= */
function clearInputs() {
  subjects.forEach((_, i) => document.getElementById(`sub${i}`).value = "");
  document.getElementById("result").innerHTML = "";
}

function logout() {
  localStorage.clear();
  window.location.href = "index.html";
}
</script>

</body>
</html>const semester = localStorage.getItem("semester");

// Allow ONLY 7th semester
if (!name || semester !== "7") {
  window.location.href = "under_construction.html";
}

document.getElementById("userInfo").innerText =
  `ðŸ‘¤ ${name} | Semester: ${semester}`;
document.getElementById("title").innerText =
  `7th Semester SGPA Predictor`;

/* ===========================
   ðŸ“˜ 7th SEM SUBJECTS
=========================== */
const subjects = [
  { name: "Neural Networks and Deep Learning", credits: 4, isHalf: false },
  { name: "Medical Imaging Techniques", credits: 3, isHalf: false },
  { name: "Wearable Devices", credits: 3, isHalf: false },
  { name: "Open Elective", credits: 3, isHalf: false },
  { name: "Skill Enhancement Lab", credits: 3, isHalf: true },
  { name: "AI in Healthcare Lab", credits: 1, isHalf: true }
];

/* ===========================
   ðŸŽ“ GRADING SETUP
=========================== */
const grades = [10, 9, 8, 7, 6, 5, 0];
const gradeLabels = {10:"O",9:"A+",8:"A",7:"B+",6:"B",5:"C",0:"F"};
const selectedGrades = {};

/* ===========================
   ðŸ§± BUILD FORM
=========================== */
const form = document.getElementById("form");
subjects.forEach((sub, i) => {
  const div = document.createElement("div");
  div.className = "subject-group";
  div.innerHTML = `
    <label>${sub.name} (Internal Marks):</label>
    <input type="number" id="sub${i}" min="0" max="50">
  `;
  form.appendChild(div);
});

/* ===========================
   ðŸ“Š CALCULATION LOGIC
=========================== */
function calculateRequiredMarks(internal, grade, isHalf) {
  const lower = {10:90,9:80,8:70,7:60,6:50,5:40}[grade];
  if (!lower) return -1;
  const req = isHalf ? (lower - internal) : 2 * (lower - internal);
  const max = isHalf ? 50 : 100;
  return (req < 0 || req > max) ? -1 : req;
}

function predictGrades() {
  document.getElementById("result").innerHTML = "";
  Object.keys(selectedGrades).forEach(k => delete selectedGrades[k]);

  let html = "";

  subjects.forEach((sub, i) => {
    const internal = parseFloat(document.getElementById(`sub${i}`).value);
    if (isNaN(internal)) return;

    html += `<h3>${sub.name}</h3><table class="output-table"><tr>`;
    grades.forEach(g => html += `<th>${gradeLabels[g]}</th>`);
    html += `</tr><tr>`;

    grades.forEach(g => {
      const r = calculateRequiredMarks(internal, g, sub.isHalf);
      const cls = r === -1 ? "not-possible" :
                  (r <= (sub.isHalf ? 45 : 86) ? "realistic" : "possible");
      html += `<td class="${cls}">${r === -1 ? "-" : r.toFixed(1)}</td>`;
    });

    html += `</tr></table>`;

    let def = 0;
    for (let g of grades) {
      const r = calculateRequiredMarks(internal, g, sub.isHalf);
      if (r !== -1 && r <= (sub.isHalf ? 45 : 86)) { def = g; break; }
    }

    selectedGrades[sub.name] = def;

    html += `<p><strong>Select Expected Grade:</strong><br>`;
    grades.forEach(g => {
      html += `
        <label>
          <input type="radio" name="g${i}" ${g===def?"checked":""}
          onchange="updateSelectedGrade('${sub.name}',${g})">
          ${gradeLabels[g]}
        </label>
      `;
    });
    html += `</p>`;
  });

  document.getElementById("result").innerHTML = html;
  updateSGPA();
}

function updateSelectedGrade(sub, g) {
  selectedGrades[sub] = g;
  updateSGPA();
}

function updateSGPA() {
  let tc=0,tp=0;
  subjects.forEach(s=>{
    if (selectedGrades[s.name] !== undefined) {
      tc += s.credits;
      tp += selectedGrades[s.name] * s.credits;
    }
  });
  
const sgpa = (tp / tc).toFixed(2);
document.getElementById("result")
  .insertAdjacentHTML("beforeend", `<h2>ðŸŽ¯ SGPA: ${sgpa}</h2>`);

saveResult(sgpa);
function clearInputs() {
  subjects.forEach((_,i)=>document.getElementById(`sub${i}`).value="");
  document.getElementById("result").innerHTML="";
}

function logout() {
  localStorage.clear();
  window.location.href = "index.html";
}
 function saveResult(sgpa) {
  fetch("https://sgpa-backend-m676.onrender.com/save-history", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: name,
      semester: semester,
      result: sgpa,
      grades: selectedGrades
    })
  });
}
</script>

</body>
</html>
